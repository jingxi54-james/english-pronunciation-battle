# è…¾è®¯äº‘ TTS å’Œè¯­éŸ³è¯†åˆ« API ç”³è¯·æŒ‡å—

## ğŸ“‹ æ¦‚è¿°

æœ¬æŒ‡å—è¯´æ˜å¦‚ä½•ç”³è¯·å’Œé…ç½®è…¾è®¯äº‘çš„æ–‡å­—è½¬è¯­éŸ³ï¼ˆTTSï¼‰å’Œè¯­éŸ³è¯†åˆ«ï¼ˆASRï¼‰æœåŠ¡ï¼Œç”¨äºå¾®ä¿¡å°ç¨‹åºç‰ˆæœ¬ã€‚

## ğŸ”‘ ç¬¬ä¸€æ­¥ï¼šæ³¨å†Œè…¾è®¯äº‘è´¦å·

### 1. è®¿é—®è…¾è®¯äº‘å®˜ç½‘
- ç½‘å€ï¼šhttps://cloud.tencent.com/
- ç‚¹å‡»å³ä¸Šè§’"ç™»å½•"æˆ–"æ³¨å†Œ"

### 2. æ³¨å†Œæ–°è´¦å·
- é€‰æ‹©"é‚®ç®±æ³¨å†Œ"æˆ–"å¾®ä¿¡æ³¨å†Œ"
- å¡«å†™ç›¸å…³ä¿¡æ¯
- å®Œæˆèº«ä»½éªŒè¯ï¼ˆéœ€è¦å®åè®¤è¯ï¼‰

### 3. å®åè®¤è¯
- ç™»å½•åè¿›å…¥"è´¦å·ä¸­å¿ƒ"
- ç‚¹å‡»"å®åè®¤è¯"
- é€‰æ‹©"ä¸ªäººè®¤è¯"æˆ–"ä¼ä¸šè®¤è¯"
- ä¸Šä¼ èº«ä»½è¯ç…§ç‰‡
- ç­‰å¾…å®¡æ ¸ï¼ˆé€šå¸¸ 1-3 å¤©ï¼‰

## ğŸ¯ ç¬¬äºŒæ­¥ï¼šå¼€é€š TTS æœåŠ¡

### 1. è¿›å…¥ TTS æœåŠ¡é¡µé¢
- è®¿é—®ï¼šhttps://cloud.tencent.com/product/tts
- æˆ–åœ¨æ§åˆ¶å°æœç´¢"æ–‡å­—è½¬è¯­éŸ³"

### 2. ç‚¹å‡»"ç«‹å³ä½¿ç”¨"
- é€‰æ‹©"æ–‡å­—è½¬è¯­éŸ³ TTS"
- ç‚¹å‡»"ç«‹å³å¼€é€š"

### 3. é€‰æ‹©è®¡è´¹æ–¹å¼
- **æŒ‰é‡è®¡è´¹**ï¼ˆæ¨èæ–°ç”¨æˆ·ï¼‰
  - æŒ‰å®é™…ä½¿ç”¨é‡è®¡è´¹
  - æ¯æœˆæœ‰å…è´¹é¢åº¦ï¼ˆ10 ä¸‡å­—ç¬¦ï¼‰
  - è¶…å‡ºéƒ¨åˆ†æŒ‰ 0.0001 å…ƒ/å­—ç¬¦è®¡è´¹

- **é¢„ä»˜è´¹å¥—é¤**
  - ä¸€æ¬¡æ€§è´­ä¹°å­—ç¬¦åŒ…
  - ä»·æ ¼æ›´ä¼˜æƒ 
  - é€‚åˆå¤§é‡ä½¿ç”¨

### 4. å¼€é€šæˆåŠŸ
- ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†é… SecretId å’Œ SecretKey
- ä¿å­˜è¿™äº›å‡­è¯ï¼ˆåç»­éœ€è¦ä½¿ç”¨ï¼‰

## ğŸ¯ ç¬¬ä¸‰æ­¥ï¼šå¼€é€šè¯­éŸ³è¯†åˆ«æœåŠ¡

### 1. è¿›å…¥è¯­éŸ³è¯†åˆ«é¡µé¢
- è®¿é—®ï¼šhttps://cloud.tencent.com/product/asr
- æˆ–åœ¨æ§åˆ¶å°æœç´¢"è¯­éŸ³è¯†åˆ«"

### 2. ç‚¹å‡»"ç«‹å³ä½¿ç”¨"
- é€‰æ‹©"è¯­éŸ³è¯†åˆ« ASR"
- ç‚¹å‡»"ç«‹å³å¼€é€š"

### 3. é€‰æ‹©è®¡è´¹æ–¹å¼
- **æŒ‰é‡è®¡è´¹**ï¼ˆæ¨èæ–°ç”¨æˆ·ï¼‰
  - æŒ‰å®é™…ä½¿ç”¨é‡è®¡è´¹
  - æ¯æœˆæœ‰å…è´¹é¢åº¦ï¼ˆ15 å°æ—¶ï¼‰
  - è¶…å‡ºéƒ¨åˆ†æŒ‰ 0.0015 å…ƒ/ç§’è®¡è´¹

- **é¢„ä»˜è´¹å¥—é¤**
  - ä¸€æ¬¡æ€§è´­ä¹°æ—¶é•¿åŒ…
  - ä»·æ ¼æ›´ä¼˜æƒ 
  - é€‚åˆå¤§é‡ä½¿ç”¨

### 4. å¼€é€šæˆåŠŸ
- ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ†é… SecretId å’Œ SecretKey
- ä¿å­˜è¿™äº›å‡­è¯

## ğŸ” ç¬¬å››æ­¥ï¼šè·å– API å‡­è¯

### 1. è¿›å…¥ API å¯†é’¥ç®¡ç†
- ç™»å½•è…¾è®¯äº‘æ§åˆ¶å°
- ç‚¹å‡»å³ä¸Šè§’"ç”¨æˆ·å" â†’ "è®¿é—®ç®¡ç†"
- é€‰æ‹©"è®¿é—®å¯†é’¥" â†’ "API å¯†é’¥ç®¡ç†"

### 2. åˆ›å»ºæ–°å¯†é’¥
- ç‚¹å‡»"æ–°å»ºå¯†é’¥"
- ç³»ç»Ÿä¼šç”Ÿæˆ SecretId å’Œ SecretKey
- **é‡è¦**ï¼šå¦¥å–„ä¿ç®¡è¿™äº›å‡­è¯ï¼Œä¸è¦æ³„éœ²

### 3. ä¿å­˜å‡­è¯
```
SecretId: AKIDxxxxxxxxxxxxxxxxxxxxxxxx
SecretKey: xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx
```

## ğŸ“ ç¬¬äº”æ­¥ï¼šé…ç½®å°ç¨‹åº

### 1. åœ¨å°ç¨‹åºåç«¯åˆ›å»º API æ¥å£

åˆ›å»ºæ–‡ä»¶ `wechat-miniapp/utils/tencent-cloud.js`ï¼š

```javascript
// è…¾è®¯äº‘ TTS å’Œ ASR é…ç½®
export const tencentCloudConfig = {
  secretId: 'YOUR_SECRET_ID',
  secretKey: 'YOUR_SECRET_KEY',
  region: 'ap-beijing',  // åœ°åŸŸï¼Œå¯é€‰ï¼šap-beijing, ap-shanghai ç­‰
  ttsEndpoint: 'tts.tencentcloudapi.com',
  asrEndpoint: 'asr.tencentcloudapi.com'
};

// TTS æœåŠ¡è°ƒç”¨
export async function callTTS(text) {
  try {
    const response = await wx.request({
      url: 'https://YOUR_BACKEND_URL/api/tts',  // ä½ çš„åç«¯ API
      method: 'POST',
      data: {
        text: text,
        voiceType: 0,  // 0: å¥³å£°, 1: ç”·å£°
        speed: 1.0,
        volume: 5
      }
    });
    
    if (response.statusCode === 200) {
      // æ’­æ”¾éŸ³é¢‘
      const audio = wx.createInnerAudioContext();
      audio.src = response.data.audioUrl;
      audio.play();
    }
  } catch (error) {
    console.error('TTS è°ƒç”¨å¤±è´¥:', error);
  }
}

// ASR æœåŠ¡è°ƒç”¨
export async function callASR(audioPath) {
  try {
    const response = await wx.request({
      url: 'https://YOUR_BACKEND_URL/api/asr',  // ä½ çš„åç«¯ API
      method: 'POST',
      data: {
        audioPath: audioPath
      }
    });
    
    if (response.statusCode === 200) {
      return response.data.text;  // è¿”å›è¯†åˆ«ç»“æœ
    }
  } catch (error) {
    console.error('ASR è°ƒç”¨å¤±è´¥:', error);
  }
}
```

### 2. åœ¨æ¸¸æˆé¡µé¢ä¸­ä½¿ç”¨

ç¼–è¾‘ `wechat-miniapp/pages/game/game.js`ï¼š

```javascript
import { callTTS, callASR } from '../../utils/tencent-cloud.js';

// æ’­æ”¾å•è¯å‘éŸ³
playWordAudio() {
  const { currentWord } = this.data;
  
  // ä½¿ç”¨è…¾è®¯äº‘ TTS
  callTTS(currentWord.word);
}

// åˆ†æå½•éŸ³
async analyzeAudio(filePath) {
  // ä½¿ç”¨è…¾è®¯äº‘ ASR è¯†åˆ«
  const recognizedText = await callASR(filePath);
  
  // è®¡ç®—å‡†ç¡®ç‡
  const accuracy = this.calculateAccuracy(recognizedText);
  this.showAccuracyResult(accuracy);
}

// è®¡ç®—å‡†ç¡®ç‡
calculateAccuracy(recognizedText) {
  const { currentWord } = this.data;
  const targetWord = currentWord.word.toLowerCase();
  const recognized = recognizedText.toLowerCase();
  
  // ç®€å•çš„ç›¸ä¼¼åº¦è®¡ç®—
  if (recognized === targetWord) {
    return 100;
  }
  
  // è®¡ç®—ç¼–è¾‘è·ç¦»
  const distance = this.levenshteinDistance(targetWord, recognized);
  const maxLength = Math.max(targetWord.length, recognized.length);
  const accuracy = Math.max(0, 100 - (distance / maxLength) * 100);
  
  return Math.round(accuracy);
}

// ç¼–è¾‘è·ç¦»ç®—æ³•
levenshteinDistance(str1, str2) {
  const matrix = [];
  
  for (let i = 0; i <= str2.length; i++) {
    matrix[i] = [i];
  }
  
  for (let j = 0; j <= str1.length; j++) {
    matrix[0][j] = j;
  }
  
  for (let i = 1; i <= str2.length; i++) {
    for (let j = 1; j <= str1.length; j++) {
      if (str2.charAt(i - 1) === str1.charAt(j - 1)) {
        matrix[i][j] = matrix[i - 1][j - 1];
      } else {
        matrix[i][j] = Math.min(
          matrix[i - 1][j - 1] + 1,
          matrix[i][j - 1] + 1,
          matrix[i - 1][j] + 1
        );
      }
    }
  }
  
  return matrix[str2.length][str1.length];
}
```

## ğŸ–¥ï¸ ç¬¬å…­æ­¥ï¼šåˆ›å»ºåç«¯æœåŠ¡

### æ–¹æ¡ˆ Aï¼šä½¿ç”¨ Node.js + Express

åˆ›å»ºæ–‡ä»¶ `backend/routes/tts.js`ï¼š

```javascript
const express = require('express');
const tencentcloud = require('tencentcloud-sdk-nodejs');
const router = express.Router();

const TtsClient = tencentcloud.tts.v20190823.Client;
const clientConfig = {
  credential: {
    secretId: process.env.TENCENT_SECRET_ID,
    secretKey: process.env.TENCENT_SECRET_KEY,
  },
  region: 'ap-beijing',
  profile: {
    httpProfile: {
      endpoint: 'tts.tencentcloudapi.com',
    },
  },
};

const client = new TtsClient(clientConfig);

router.post('/tts', async (req, res) => {
  try {
    const { text, voiceType = 0, speed = 1.0, volume = 5 } = req.body;
    
    const params = {
      Text: text,
      SessionId: Date.now().toString(),
      ModelType: 1,
      SampleRate: 16000,
      VoiceType: voiceType,
      Speed: speed,
      Volume: volume,
      Language: 1,  // 1: ä¸­æ–‡, 2: è‹±æ–‡
    };
    
    const response = await client.TextToSpeech(params);
    
    // å°†éŸ³é¢‘æ•°æ®ä¿å­˜åˆ°æ–‡ä»¶æˆ–è¿”å› URL
    res.json({
      success: true,
      audioUrl: response.Audio,  // Base64 ç¼–ç çš„éŸ³é¢‘æ•°æ®
    });
  } catch (error) {
    console.error('TTS é”™è¯¯:', error);
    res.status(500).json({
      success: false,
      error: error.message,
    });
  }
});

module.exports = router;
```

åˆ›å»ºæ–‡ä»¶ `backend/routes/asr.js`ï¼š

```javascript
const express = require('express');
const tencentcloud = require('tencentcloud-sdk-nodejs');
const fs = require('fs');
const router = express.Router();

const AsrClient = tencentcloud.asr.v20190614.Client;
const clientConfig = {
  credential: {
    secretId: process.env.TENCENT_SECRET_ID,
    secretKey: process.env.TENCENT_SECRET_KEY,
  },
  region: 'ap-beijing',
  profile: {
    httpProfile: {
      endpoint: 'asr.tencentcloudapi.com',
    },
  },
};

const client = new AsrClient(clientConfig);

router.post('/asr', async (req, res) => {
  try {
    const { audioPath } = req.body;
    
    // è¯»å–éŸ³é¢‘æ–‡ä»¶
    const audioData = fs.readFileSync(audioPath);
    const audioBase64 = audioData.toString('base64');
    
    const params = {
      ProjectId: 0,
      SubServiceType: 2,  // 2: ä¸€å¥è¯è¯†åˆ«
      EngSerViceType: '16k_zh',  // 16k ä¸­æ–‡
      SourceType: 1,  // 1: æœ¬åœ°æ–‡ä»¶
      Data: audioBase64,
      DataLen: audioData.length,
    };
    
    const response = await client.SentenceRecognition(params);
    
    res.json({
      success: true,
      text: response.Result,
      confidence: response.Confidence,
    });
  } catch (error) {
    console.error('ASR é”™è¯¯:', error);
    res.status(500).json({
      success: false,
      error: error.message,
    });
  }
});

module.exports = router;
```

### æ–¹æ¡ˆ Bï¼šä½¿ç”¨äº‘å‡½æ•°ï¼ˆæ¨èï¼‰

åœ¨è…¾è®¯äº‘åˆ›å»ºäº‘å‡½æ•°ï¼Œè‡ªåŠ¨å¤„ç† TTS å’Œ ASR è¯·æ±‚ã€‚

## ğŸ’° è´¹ç”¨ä¼°ç®—

### TTS è´¹ç”¨
- å…è´¹é¢åº¦ï¼š10 ä¸‡å­—ç¬¦/æœˆ
- è¶…å‡ºéƒ¨åˆ†ï¼š0.0001 å…ƒ/å­—ç¬¦
- ç¤ºä¾‹ï¼š100 ä¸‡å­—ç¬¦ = 100 å…ƒ

### ASR è´¹ç”¨
- å…è´¹é¢åº¦ï¼š15 å°æ—¶/æœˆ
- è¶…å‡ºéƒ¨åˆ†ï¼š0.0015 å…ƒ/ç§’
- ç¤ºä¾‹ï¼š100 å°æ—¶ = 540 å…ƒ

### æ€»ä½“ä¼°ç®—
- å°è§„æ¨¡ä½¿ç”¨ï¼ˆ< 10 ä¸‡å­—ç¬¦ + 15 å°æ—¶ï¼‰ï¼š**å…è´¹**
- ä¸­ç­‰è§„æ¨¡ä½¿ç”¨ï¼š**50-200 å…ƒ/æœˆ**
- å¤§è§„æ¨¡ä½¿ç”¨ï¼š**500+ å…ƒ/æœˆ**

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **API å‡­è¯å®‰å…¨**
   - ä¸è¦åœ¨å‰ç«¯ä»£ç ä¸­ç¡¬ç¼–ç  SecretKey
   - ä½¿ç”¨åç«¯æœåŠ¡ä¸­è½¬è¯·æ±‚
   - å®šæœŸè½®æ¢å¯†é’¥

2. **è¯·æ±‚é™åˆ¶**
   - TTSï¼šæ¯ç§’æœ€å¤š 100 ä¸ªè¯·æ±‚
   - ASRï¼šæ¯ç§’æœ€å¤š 50 ä¸ªè¯·æ±‚
   - éœ€è¦æ·»åŠ è¯·æ±‚é˜Ÿåˆ—å’Œé™æµ

3. **éŸ³é¢‘æ ¼å¼**
   - TTS è¾“å‡ºï¼šMP3 æ ¼å¼
   - ASR è¾“å…¥ï¼šWAVã€MP3ã€FLAC ç­‰æ ¼å¼
   - å»ºè®®ä½¿ç”¨ 16kHz é‡‡æ ·ç‡

4. **æˆæœ¬æ§åˆ¶**
   - è®¾ç½®æ¯æ—¥/æ¯æœˆæ¶ˆè´¹é™é¢
   - ç›‘æ§ API è°ƒç”¨é‡
   - å®šæœŸæ£€æŸ¥è´¦å•

## ğŸ”— ç›¸å…³é“¾æ¥

- [è…¾è®¯äº‘ TTS æ–‡æ¡£](https://cloud.tencent.com/document/product/1073)
- [è…¾è®¯äº‘ ASR æ–‡æ¡£](https://cloud.tencent.com/document/product/1093)
- [è…¾è®¯äº‘ SDK ä¸‹è½½](https://cloud.tencent.com/document/sdk)
- [è…¾è®¯äº‘æ§åˆ¶å°](https://console.cloud.tencent.com/)

## ğŸ“ æŠ€æœ¯æ”¯æŒ

- è…¾è®¯äº‘å®˜æ–¹æ–‡æ¡£ï¼šhttps://cloud.tencent.com/document
- è…¾è®¯äº‘ç¤¾åŒºï¼šhttps://cloud.tencent.com/developer
- å·¥å•æ”¯æŒï¼šç™»å½•æ§åˆ¶å° â†’ å·¥å•ç³»ç»Ÿ

## âœ… æ£€æŸ¥æ¸…å•

- [ ] æ³¨å†Œè…¾è®¯äº‘è´¦å·
- [ ] å®Œæˆå®åè®¤è¯
- [ ] å¼€é€š TTS æœåŠ¡
- [ ] å¼€é€š ASR æœåŠ¡
- [ ] è·å– SecretId å’Œ SecretKey
- [ ] åˆ›å»ºåç«¯ API æ¥å£
- [ ] é…ç½®å°ç¨‹åºè°ƒç”¨
- [ ] æµ‹è¯• TTS åŠŸèƒ½
- [ ] æµ‹è¯• ASR åŠŸèƒ½
- [ ] ç›‘æ§æˆæœ¬

---

**æç¤º**ï¼šå»ºè®®å…ˆä½¿ç”¨å…è´¹é¢åº¦æµ‹è¯•ï¼Œç¡®è®¤åŠŸèƒ½æ­£å¸¸åå†è€ƒè™‘ä»˜è´¹ã€‚
